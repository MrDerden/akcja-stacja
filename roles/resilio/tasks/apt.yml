---
- name: Kill old BTSync process
  ignore_errors: true
  shell: pkill -TERM btsync

- name: Disable autostart of old BTSync
  file:
    path: "{{home}}/.config/autostart/btsync.desktop"
    state: absent

#- name: Uninstall btsync
#  apt: name=btsync state=uninstalled

- stat:
    path: "{{home}}/.config/btsync"
  register: btsync_storage

- stat:
    path: "{{home}}/.sync"
  register: resilio_storage

- name: "Maybe move resilio storage to new loction for {{home}}"
  shell: "cp -a {{home}}/.config/btsync/storage {{home}}/.sync"
  when: resilio_storage.stat.exists == false  and btsync_storage.stat.exists == true

- name: Install Resilio key
  apt_key:
    url: https://linux-packages.resilio.com/resilio-sync/key.asc
    state: present

- name: Install Resilio package repositories
  apt_repository:
    repo: "deb http://linux-packages.resilio.com/resilio-sync/deb resilio-sync non-free"
    state: present

- name: Install Resilio package keys
  apt_key:
    url: "https://linux-packages.resilio.com/resilio-sync/key.asc"
    state: present

- name: Install Resilio
  apt:
    name: resilio-sync
    state: present
    force: yes

